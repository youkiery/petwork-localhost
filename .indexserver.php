<?php
header('Access-Control-Allow-Origin: *');
header("Access-Control-Allow-Credentials: true");

define('ROOTDIR', pathinfo(str_replace(DIRECTORY_SEPARATOR, '/', __file__), PATHINFO_DIRNAME));
define('DIR', str_replace('/server', '/', ROOTDIR));
include_once(ROOTDIR . '/include/config.php');
include_once(ROOTDIR . '/include/db.php');
include_once(ROOTDIR . '/include/global.php');
$db = new database("thanhxuanpet", $config['username'], $config['password'], $config['database']);

// $arr = array(
//   '24/12',
//   ''
// );

// $sql = "select * from pet_". PREFIX ."_vaccine where utemp = 0 and recall = 0";
// $l = $db->all($sql);

// foreach ($l as $r) {
//   $note = $r['note'];
//   $a = explode(';', $note);
//   $d = explode('/', $a[0]);
//   $date = strtotime("$d[2]/$d[1]/$d[0]");
//   $note = $a[2];
//   $sql = "update pet_". PREFIX ."_vaccine set recall = $date, note = 'note' where id = $r[id]";
//   echo "$sql ($note) <br>";
// }

$json = json_decode('{"pet_test_account":["id","time","content"],"pet_test_accountname":["id","name"],"pet_test_chuyenmon":["id","idnhanvien","iddanhmuc"],"pet_test_chuyenmondichvu":["id","idchuyenmon","iddichvu"],"pet_test_config":["id","module","name","value","alt"],"pet_test_cophan":["id","idnhanvien","tile","giatri","ghichu"],"pet_test_customer":["id","name","phone","address","mail","pass","tinhcach","session","loaitru"],"pet_test_danhgia":["id","idkhachhang","nhanvien","muchailong","lydo","noidung","thoigian"],"pet_test_danhmuc":["id","tendanhmuc","loaidanhmuc","vitri","macdinh","thoigian","kichhoat"],"pet_test_danhmucgia":["id","iddanhmuc","khoangcan","sotien"],"pet_test_datlich":["id","loaidatlich","idkhachdat","idnhanvien","idkhachhang","ipkhach","ghichu","thoigiandukien","giadukien","thoigian","ngaydat","trangthai"],"pet_test_datlichchitiet":["id","iddatlich","iddanhmuc"],"pet_test_dieutricong":["id","code","name","active"],"pet_test_dieutridichvu":["id","idkhach","idnhanvien","idloai","soluong","tongtien","thoigian"],"pet_test_dieutrima":["id","code"],"pet_test_dieutritaikham":["id","idkhach","thoigianden","thoigian","trangthai"],"pet_test_dieutrithuoc":["id","idkhach","idnhanvien","idloai","soluong","tongtien","thoigian"],"pet_test_drug":["id","code","name","unit","system","limits","effect","effective","disease","note","sideeffect","mechanic","image"],"pet_test_exam":["id","userid","customerid","treatid","typeid","image","note","time","status"],"pet_test_exam_type":["id","name","active"],"pet_test_form":["id","name","value"],"pet_test_hanghoa":["id","mahang","tenhang","loaihang","giaban","gianhap","soluong","hinhanh","gioithieu","donvi","kichhoat"],"pet_test_hanghoathanhphan":["id","idhang","idthanhphan","chuyendoi"],"pet_test_hanghoathaydoi":["id","idhang","giadau","giacuoi","thoigian"],"pet_test_hanghoa_donhang":["id","khachhang","dienthoai","diachi","thoigian","tongtien","trangthai","ghichu","token","idkhach"],"pet_test_hanghoa_donhang_chitiet":["id","iddonhang","idhang","soluong","giaban"],"pet_test_hotel":["id","customerid","catid","health","cometime","calltime","returntime","image","returnimage","returnuserid","status"],"pet_test_hotel_cat":["id","name","price","active"],"pet_test_import":["id","time","price","note","userid","module"],"pet_test_kaizen":["id","userid","problem","solution","result","post_time","edit_time","active","done","image","noidungdongdoi","noidungtugiac","hinhanhdongdoi","hinhanhtugiac"],"pet_test_lichban":["id","idnhanvien","lydo","batdau","ketthuc"],"pet_test_lichchamcong":["id","idnhanvien","thoigian"],"pet_test_lichchamcongca":["id","giovao","giora"],"pet_test_lichchamcongdaccach":["id","idnhanvien","thoigian"],"pet_test_luong":["id","doanhthu","loinhuan","tienchi","luongnhanvien","lairong","thoigian","trangthai"],"pet_test_luong_chot":["id","thoigiandau","thoigiancuoi"],"pet_test_luong_chotlich":["id","idnhanvien","nghilo","batdau","ketthuc"],"pet_test_luong_dulieu":["id","idnhanvien","luongcoban","phucap","doanhsobanhang","doanhsospa","nghiphep","thuong","tietkiem","tongluong","thucnhan","cophan","thoigian","thoigianthem"],"pet_test_luong_nhanvien":["id","userid","luongcoban","kyhopdong","tiletietkiem","lenluong","phucap","tamnghi","heluong","tenkiot"],"pet_test_luong_tienchi":["id","luongid","mucchi","tienchi"],"pet_test_luong_tra":["id","userid","luongid","doanhthu","loinhuan","luong","tile","tilethuong","thuong","luongphucap","phucap2","phucap","ngaynghi","nghiphep","tietkiem","nhantietkiem","tilecophan","cophan","tong","thucnhan"],"pet_test_manual":["id","title","module"],"pet_test_manual_row":["id","type","content","manualid"],"pet_test_nhomtin":["id","tennhom","mautin","thoigian"],"pet_test_nhomtinchitiet":["id","idlienket","thoigian"],"pet_test_nhomtinlienket":["id","idnhomtin","idkhachhang"],"pet_test_nhomtinloai":["id","idnhomtin","loai","idloai"],"pet_test_notify":["id","userid","status","content","module","time"],"pet_test_pet":["id","name","customerid"],"pet_test_physical":["id","customer","phone","address","name","weight","age","gender","species","serial","sampletype","samplenumber","samplesymbol","samplestatus","doctor","time","symptom","image"],"pet_test_physical_data":["id","pid","tid","value"],"pet_test_price":["id","name","unit"],"pet_test_price_detail":["id","itemid","name","price"],"pet_test_profile":["id","customer","phone","address","name","weight","age","gender","species","serial","sampletype","samplenumber","samplesymbol","samplestatus","doctor","time","symptom","image"],"pet_test_profile_data":["id","pid","tid","value"],"pet_test_ride":["id","userid","clockf","clocke","money","destination","note","time"],"pet_test_row":["id","type","user_id","time","reg_time"],"pet_test_row_log":["id","userid","type","time","reg_time","reg_type"],"pet_test_session":["id","userid","session","time"],"pet_test_sieuam":["id","userid","customerid","image","note","time"],"pet_test_spa":["id","doctorid","customerid","customerid2","note","time","utime","image","dimage","status","weight","ltime","luser","duser","rate","treat","number"],"pet_test_spadichvu":["id","idkhach","idnhanvien","idloai","soluong","tongtien","thoigian"],"pet_test_spaloai":["id","code","name","active"],"pet_test_spanhanvien":["id","ten"],"pet_test_spa_row":["id","typeid","spaid"],"pet_test_spa_schedule":["id","customerid","image","note","time","ctime","status"],"pet_test_spa_type":["id","name"],"pet_test_taichinh_chi":["id","idloaichi","giatri","ghichu","thoigian","codinh"],"pet_test_taichinh_chicodinh":["id","idloaichi","giatri"],"pet_test_taichinh_chincc":["id","idnhacungcap","noidung","giatri","thoigian","thoigianthem","ghichu"],"pet_test_taichinh_chivattu":["id","ten","donvi","soluong","thoigian","giatri","tile","ghichu"],"pet_test_taichinh_hinhanh":["id","idtaichinh","hinhanh","loai"],"pet_test_taichinh_loaichi":["id","ten","idnhom","kichhoat"],"pet_test_taichinh_nhacungcap":["id","ten","kichhoat"],"pet_test_taichinh_nhomchi":["id","ten","kichhoat"],"pet_test_taichinh_noncc":["id","idnhacungcap","noidung","giatri","thoigian","thoigianthem","ghichu"],"pet_test_taichinh_thu":["id","tienmat","nganhang","thoigian"],"pet_test_taichinh_tilebanhang":["id","idnhanvien","khoang","tien"],"pet_test_taichinh_tilespa":["id","idnhanvien","loinhuanbanhang","loinhuanspa","chietkhaubanhang","chietkhauspa"],"pet_test_target":["id","name","number","active","unit","flag","intro","up","down","disease","aim","module"],"pet_test_thaydoilich":["id","userid","ngaythaydoi","buoithaydoi","loaithaydoi","thoigian"],"pet_test_thietbi":["id","ten","hinhanh","congdung","link"],"pet_test_transport":["id","name","phone","address"],"pet_test_users":["userid","username","name","idvantay","password","photo","regdate","session","fullname","active","placeid","birthday"],"pet_test_user_per":["id","userid","module","alt","type"],"pet_test_usg":["id","userid","cometime","calltime","recall","number","called","image","status","note","time","customerid","utemp","vaccinetime","daden"],"pet_test_vaccine":["id","typeid","cometime","calltime","note","status","recall","userid","time","petid","called","utemp"],"pet_test_vaccinecauhinh":["id","idnhom","ngay"],"pet_test_vaccinelienketmautin":["id","idloai","idmautin","idnhom"],"pet_test_vaccineloai":["id","name","code","active","idnhom"],"pet_test_vaccineloainhom":["id","name","active"],"pet_test_vaccineloaitru":["id","idkhach"],"pet_test_vaccinemautin":["id","mautin","lich","loainhac","sukien","kichhoat"],"pet_test_vaccinenhantin":["id","idmautin","idvaccine","thoigian"],"pet_test_vaccinetaichung":["id","idkhachhang","thoigian"],"pet_test_vattu":["id","idchi","ten","donvi","soluong","thoigian","giatri","tile","ghichu"],"pet_test_vattunoitang":["id","idvattu","idtang"],"pet_test_vattutang":["id","ten"],"pet_test_vattu_loaichi":["id","loaichi"],"pet_test_work":["id","userid","departid","title","content","file","time","createtime","expiretime","updatetime","status"],"pet_test_work_assign":["id","workid","userid"],"pet_test_work_comment":["id","workid","userid","comment","file","time"],"pet_test_work_depart":["id","name","parentid","active"],"pet_test_work_depart_user":["id","departid","userid","type"],"pet_test_work_follow":["id","userid","workid"],"pet_test_work_repeat":["id","workid","type","time","list","status"],"pet_test_xquang":["id","userid","customerid","image","note","time"],"pet_test_xray":["id","petid","doctorid","insult","time","rate","share","pos","diseaseid","customerid","petname","weight","age","species","gender"],"pet_test_xray_chat":["id","postid","side","time","text"],"pet_test_xray_disease":["id","name","active"],"pet_test_xray_his":["id","petid","his","time"],"pet_test_xray_read":["id","userid","postid","side","time"],"pet_test_xray_row":["id","xrayid","temperate","subother","other","image","time","treat","status","doctorid","pay","xquang","sieuam","sinhly","sinhhoa","nuoctieu","conclude"],"pet_test_xray_schedule":["id","xrayid","time","status"]}');

$branch = ["nhatrang", "nhatrang3"];
foreach ($json as $key => $row) {
  foreach ($branch as $prefix) {
    $tablename = "pet_". $prefix ."_". $key;
    $sql = "SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '$config[database]' AND TABLE_NAME = '$tablename'";
    if (empty($r = $db->fetch($sql))) {
      echo "missing: $key <br>";
    }
    else {
      foreach ($row as $r) {
        $sql = "SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '$config[database]' AND TABLE_NAME = '$tablename' and COLUMN_NAME = '$r'";
        if (empty($x = $db->fetch($sql))) {
          echo "missing: $key ($r) <br>";
        }
      }
    }
  }
}
